/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function e(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))}var t;!function(e){e.Play="K",e.Ahead5="L",e.Prev5="J",e.Ahead10=";",e.Prev10="H",e.Seek0="0",e.Seek1="1",e.Seek2="2",e.Seek3="3",e.Seek4="4",e.Seek5="5",e.Seek6="6",e.Seek7="7",e.Seek8="8",e.Seek9="9"}(t||(t={}));const n=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n}(t,["Play","Prev10","Prev5","Ahead10","Ahead5"]),o=Object.values(t);Object.values(n);
// ==UserScript==
// @name         HTML Video Controls
// @namespace    http://github.com/kiiluchris/Userscripts/
// @version      0.2
// @description  try to take over the world!
// @author       kiiluchris
// @match        http*://**/*
// @grant        none
// ==/UserScript==
function a(){const e={chrome:!1,firefox:!1};return navigator.userAgent.toLowerCase().includes("firefox")?e.firefox=!0:e.chrome=!0,e}const i=e=>(t,n)=>t*e-n*e,r=i(.5),s=i(.25),l=e=>`${e}px`;function c(e){const t=document.createElement("div"),n=(o=t,e=>{const t=s(e.clientHeight,+o.dataset.height),n=r(e.clientWidth,+o.dataset.width);o.style.top=l(t),o.style.left=l(n)});var o;return t.innerText="1 X",function(e,t,n){e.style.backgroundColor="rgba(0,0,0,0.5)",e.style.color="#fff",e.style.textAlign="center",e.style.borderRadius="10%",e.style.position="absolute",e.style.zIndex="2147483647",e.style.display="none",e.style.width=l(t),e.style.height=l(n),e.style.lineHeight=e.style.height,e.dataset.width=t+"",e.dataset.height=n+""}(t,80,50),n(e),e.insertAdjacentElement("afterend",t),e.playbackRateOverlay=t,function(e,t,n){document.addEventListener("fullscreenchange",n),window.addEventListener("resize",n);let o=null;t.addEventListener("ratechange",n=>{console.log(`New Video Rate: ${t.playbackRate}`),"true"!==t.dataset.hasOwnPlaybackControls&&(e.style.display="",e.innerText=t.playbackRate+" X",null!==o&&clearTimeout(o),o=setTimeout(()=>{o=null,e.style.display="none"},1e3))})}(t,e,t=>{n(e)}),t}const d=/www.youtube.com/,u=[/www.youtube.com/];function y(e,t){e.addEventListener("click",e=>{e.stopPropagation(),t(e)})}function f(e,t){return(n,o)=>{"true"!==n.dataset[e]&&(n.dataset[e]="true",t(n,o))}}function p(){const e=document.createElement("button");return e.style.display="none",document.body.appendChild(e),e}function h(e,t){e.currentTime<t?e.currentTime=0:e.currentTime-=t}function v(e,t){e.duration-e.currentTime<t?e.currentTime=e.duration:e.currentTime+=t}const m=[f("playbackRateChange",(e,t)=>{!u.some(e=>e.test(window.location.href))&&c(e)}),f("playbackRateChangeUi",(e,t)=>{!function(e,t){if("true"===e.dataset.controlsAdded)return;e.dataset.controlsAdded="true";const n=document.createElement("div"),o=document.createElement("p"),a=document.createElement("p");o.innerHTML="&#x1F40C;",a.innerHTML="&#x1F407;",o.style.color="#fff",a.style.color="#fff",n.style.position="absolute",n.style.display="inline-flex",n.style.gridColumnGap="8px",n.style.top="10px",n.style.left="10px",n.style.zIndex="1000000",n.appendChild(o),n.appendChild(a),e.parentElement.appendChild(n),y(o,n=>{e.playbackRate-=t}),y(a,n=>{e.playbackRate+=t})}(e,t.playbackChangeRate)}),f("videoKeyboardEvents",(e,t)=>{e.addEventListener("focus",n=>{t.focusedVideo=()=>e}),e.addEventListener("keyup",t.blockingKeyboardHandler(e),!0),e.addEventListener("keydown",t.blockingKeyboardHandler(e),!0)}),f("windowPlayControls",(e,a)=>{window.addEventListener("keyup",e=>{const i=e.key.toUpperCase();if(!o.includes(i))return;const r=a.focusedVideo();var s;if(4===r.readyState)switch(i){case t.Play:(s=r).ended?(s.currentTime=0,s.play()):s.paused?s.play():s.pause();break;case t.Prev5:h(r,5);break;case t.Prev10:h(r,10);break;case t.Ahead5:v(r,5);break;case t.Ahead10:v(r,10);break;default:i in n&&function(e,n){const o={[t.Seek0]:0,[t.Seek1]:.1,[t.Seek2]:.2,[t.Seek3]:.3,[t.Seek4]:.4,[t.Seek5]:.5,[t.Seek6]:.6,[t.Seek7]:.7,[t.Seek8]:.8,[t.Seek9]:.9}[n];void 0!==o&&(e.currentTime=e.duration*o)}(r,i)}})}),f("videoSeekTooltip",(e,t)=>{"absolute"===e.style.position&&e.style.removeProperty("position");const n=t=>(t.pageX-e.offsetLeft)/i.offsetWidth,o=e=>{const t=e/60,n=Math.floor(t);return`${n}:${Math.floor(60*(t-n))}`},a=document.createElement("div"),i=document.createElement("progress"),r=document.createElement("div");a.appendChild(i),a.appendChild(r);i.style.width="100%",i.style.height="5px",i.value=0,i.max=e.duration,r.style.position="relative",r.style.top="5px",r.style.left="0",r.style.height="30px",r.style.width="30px",r.style.backgroundColor="#888",r.style.color="#fff",r.style.visibility="hidden",r.innerText=o(e.currentTime);let s=!1;e.addEventListener("timeupdate",t=>{s||(i.value=e.currentTime)}),i.addEventListener("mouseenter",e=>{r.style.visibility="visible"}),i.addEventListener("mousemove",t=>{s=!0;const a=n(t);r.innerText=o(e.duration*a),r.style.left=`${t.pageX}px`,i.value=i.max*a}),i.addEventListener("mouseup",t=>{const o=n(t);i.value=i.max*o,e.currentTime=e.duration*o}),i.addEventListener("mouseleave",e=>{r.style.visibility="hidden",s=!1}),e.insertAdjacentElement("afterend",a)})];function k(){const t=[...document.querySelectorAll("video")].filter(e=>"true"!==e.dataset.hasOwnPlaybackControls);if(!t.length)return[];const n={playbackChangeRate:.25,pipButton:p(),browserAgent:a(),focusedVideo:()=>t[0],eventSyncData:{isRunning:!1},get blockingKeyboardHandler(){return function(e,t){return n=>o=>{if(!t.eventSyncData.isRunning&&o.shiftKey)if("~"!==o.key){if(t.eventSyncData.isRunning=!0,"true"!==n.dataset.hasOwnPlaybackControls){switch(e(o),o.key){case"<":n.playbackRate-=t.playbackChangeRate;break;case">":n.playbackRate+=t.playbackChangeRate}setTimeout(()=>{t.eventSyncData.isRunning=!1},250)}}else t.pipButton.click()}}(e=>{e.stopImmediatePropagation()},this)}};return t.forEach(e=>{m.forEach(t=>t(e,n))}),function(t){window.addEventListener("keyup",e=>{t.blockingKeyboardHandler(t.focusedVideo())(e)}),t.pipButton.addEventListener("click",n=>e(this,void 0,void 0,(function*(){"pictureInPictureElement"in document?yield document.exitPictureInPicture():yield t.focusedVideo().requestPictureInPicture()})))}(n),function(){if(!d.test(window.location.href))return;const e=document.getElementsByTagName("ytd-app");e.length&&e[0].addEventListener("yt-navigate-finish",e=>{k()})}(),function(e){d.test(window.location.href)&&e.forEach(e=>{e.dataset.hasOwnPlaybackControls="true"})}(t),t}function b(e){return new Promise(t=>{setTimeout(()=>t(k()),1e3*e)})}(function(){return e(this,void 0,void 0,(function*(){const e=(e,...t)=>{console.group(`Pip Userscript: ${window.location.href}`),console.log(`Message: ${e}`),console.log(...t),console.groupEnd()};for(let t=0;t<=5;t++){const t=yield b(1);if(t.length)return e("PiP activated","Related Videos",t)}e("PiP not activated")}))})().catch(console.error);
